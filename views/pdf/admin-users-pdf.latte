<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Lista de Usuarios</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        font-size: 10px;
        color: #333;
      }
      h1 {
        color: #007bff;
        text-align: center;
        margin-bottom: 20px;
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      .filters {
        background-color: #f8f9fa;
        padding: 5px;
        margin-bottom: 15px;
        border-radius: 5px;
        font-size: 10px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      th {
        background-color: #007bff;
        color: white;
        padding: 8px;
        text-align: left;
      }
      td {
        padding: 6px;
        border-bottom: 1px solid #ddd;
      }
      tr:nth-child(even) {
        background-color: #f8f9fa;
      }
      .badge {
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 9px;
        font-weight: bold;
      }
      .badge-primary {
        background-color: #007bff;
        color: #fff;
      }
      .badge-danger {
        background-color: #dc3545;
        color: #fff;
      }
      .badge-warning {
        background-color: #ffc107;
        color: #000;
      }
      .badge-success {
        background-color: #28a745;
        color: #fff;
      }
      .badge-secondary {
        background-color: #6c757d;
        color: #fff;
      }
      .footer {
        text-align: center;
        margin-top: 30px;
        font-size: 9px;
        color: #666;
      }
      .empty-state {
        text-align: center;
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Lista de Usuarios</h1>
      <p>
        <strong>Generado por:</strong>
        Admin
      </p>
      <p>
        <strong>Fecha de generación:</strong>
        {=date('d/m/Y H:i')}
      </p>
    </div>

    <div class="filters" n:if="$search || $rol || $sort || $estado !== null">
      <strong>Filtros aplicados:</strong>
      <span n:if="$search">Búsqueda: {$search} |</span>
      <span n:if="$rol">Rol: {$rol} |</span>
      <span n:if="$estado !== null">Estado: {$estado == '1' ? 'Activo' : 'Inactivo'} |</span>
      <span n:if="$sort">Ordenar por: {$sort} ({$order})</span>
    </div>

    <p class="empty-state" n:if="empty($users)">
      No hay usuarios para mostrar con los filtros seleccionados.
    </p>

    <div n:if="!empty($users)">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre Completo</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Teléfono</th>
            <th>Fecha Registro</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          <tr n:foreach="$users as $user">
            <td>{$user->getId()}</td>
            <td>{$user->getNombre()} {$user->getApellidos()}</td>
            <td>{$user->getEmail()}</td>
            <td>
              {var $rolClass = $user->getRol()->value === 'Admin' ? 'badge-danger' :
              ($user->getRol()->value === 'Especialista' ? 'badge-warning' : 'badge-primary')}
              <span class="badge {$rolClass}">{$user->getRol()->value}</span>
            </td>
            <td>{$user->getTelefono() ?? '-'}</td>
            <td>{$user->getFechaRegistro()->format('d/m/Y')}</td>
            <td>
              <span class="badge {$user->getActivo() ? 'badge-success' : 'badge-secondary'}">
                {$user->getActivo() ? 'Activo' : 'Inactivo'}
              </span>
            </td>
          </tr>
        </tbody>
      </table>

      <p style="text-align: right">
        <strong>Total de usuarios listados:</strong>
        {count($users)}
      </p>
    </div>

    <div class="footer">
      <p>Documento confidencial - Uso exclusivo administrativo - {=date('d/m/Y H:i:s')}</p>
    </div>
  </body>
</html>
